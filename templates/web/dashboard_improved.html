{% extends "web/base_improved.html" %}
{% load static %}
{% load humanize %}

{% block title %}{{ page_title|default:"لوحة التحكم" }} - {{ UNIVERSITY_NAME }}{% endblock %}

{% block extra_css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js">
<style>
    :root {
        --dashboard-primary: #1e3a8a;
        --dashboard-secondary: #3b82f6;
        --dashboard-success: #10b981;
        --dashboard-warning: #f59e0b;
        --dashboard-danger: #ef4444;
        --dashboard-info: #06b6d4;
        --dashboard-light: #f8fafc;
        --dashboard-dark: #1f2937;
        --shadow-subtle: 0 1px 3px rgba(0,0,0,0.1);
        --shadow-normal: 0 4px 6px rgba(0,0,0,0.1);
        --shadow-elevated: 0 10px 25px rgba(0,0,0,0.15);
        --border-radius: 12px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        font-family: 'Cairo', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .dashboard-container {
        padding: 2rem 0;
        min-height: calc(100vh - 120px);
    }

    /* Enhanced Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 2rem;
        box-shadow: var(--shadow-normal);
        border: 1px solid rgba(0,0,0,0.05);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        cursor: pointer;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--dashboard-primary), var(--dashboard-secondary));
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-elevated);
    }

    .stat-card .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, var(--dashboard-primary), var(--dashboard-secondary));
        color: white;
        box-shadow: var(--shadow-normal);
    }

    .stat-card.success .stat-icon {
        background: linear-gradient(135deg, var(--dashboard-success), #34d399);
    }

    .stat-card.warning .stat-icon {
        background: linear-gradient(135deg, var(--dashboard-warning), #fbbf24);
    }

    .stat-card.danger .stat-icon {
        background: linear-gradient(135deg, var(--dashboard-danger), #f87171);
    }

    .stat-card.info .stat-icon {
        background: linear-gradient(135deg, var(--dashboard-info), #38bdf8);
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--dashboard-dark);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: #6b7280;
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }

    .stat-trend {
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .stat-trend.positive {
        color: var(--dashboard-success);
    }

    .stat-trend.negative {
        color: var(--dashboard-danger);
    }

    .stat-trend.neutral {
        color: #6b7280;
    }

    /* Quick Actions */
    .quick-actions {
        background: white;
        border-radius: var(--border-radius);
        padding: 2rem;
        box-shadow: var(--shadow-normal);
        margin-bottom: 2rem;
    }

    .quick-actions h3 {
        margin-bottom: 1.5rem;
        color: var(--dashboard-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .action-btn {
        display: flex;
        align-items: center;
        padding: 1rem 1.5rem;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        border: 1px solid #d1d5db;
        border-radius: var(--border-radius);
        text-decoration: none;
        color: var(--dashboard-dark);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .action-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
        transition: left 0.5s;
    }

    .action-btn:hover::before {
        left: 100%;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-normal);
        color: var(--dashboard-primary);
        border-color: var(--dashboard-primary);
    }

    .action-btn i {
        font-size: 1.5rem;
        margin-left: 1rem;
        color: var(--dashboard-primary);
    }

    /* Dashboard Grid */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .dashboard-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 2rem;
        box-shadow: var(--shadow-normal);
        border: 1px solid rgba(0,0,0,0.05);
    }

    .dashboard-card h4 {
        margin-bottom: 1.5rem;
        color: var(--dashboard-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Activity Feed */
    .activity-item {
        display: flex;
        align-items: start;
        padding: 1rem 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 1rem;
        flex-shrink: 0;
    }

    .activity-icon.success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--dashboard-success);
    }

    .activity-icon.info {
        background: rgba(6, 182, 212, 0.1);
        color: var(--dashboard-info);
    }

    .activity-icon.warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--dashboard-warning);
    }

    .activity-content {
        flex: 1;
    }

    .activity-title {
        font-weight: 600;
        color: var(--dashboard-dark);
        margin-bottom: 0.25rem;
    }

    .activity-desc {
        color: #6b7280;
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
    }

    .activity-time {
        color: #9ca3af;
        font-size: 0.75rem;
    }

    /* Notifications Panel */
    .notifications-panel {
        max-height: 400px;
        overflow-y: auto;
    }

    .notification-item {
        display: flex;
        align-items: start;
        padding: 1rem;
        border-bottom: 1px solid #f3f4f6;
        transition: var(--transition);
        cursor: pointer;
    }

    .notification-item:hover {
        background: #f8fafc;
    }

    .notification-item.unread {
        background: rgba(59, 130, 246, 0.05);
        border-right: 3px solid var(--dashboard-primary);
    }

    .notification-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--dashboard-primary);
        margin-left: 1rem;
        margin-top: 0.5rem;
        flex-shrink: 0;
    }

    .notification-content {
        flex: 1;
    }

    .notification-title {
        font-weight: 600;
        color: var(--dashboard-dark);
        margin-bottom: 0.25rem;
    }

    .notification-desc {
        color: #6b7280;
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
    }

    .notification-time {
        color: #9ca3af;
        font-size: 0.75rem;
    }

    /* Chart Container */
    .chart-container {
        position: relative;
        height: 300px;
        margin-top: 1rem;
    }

    /* Progress Bars */
    .progress-item {
        margin-bottom: 1rem;
    }

    .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .progress-label {
        font-weight: 500;
        color: var(--dashboard-dark);
    }

    .progress-value {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .progress-bar-container {
        height: 8px;
        background: #f3f4f6;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--dashboard-primary), var(--dashboard-secondary));
        border-radius: 4px;
        transition: width 1s ease-in-out;
    }

    /* Welcome Banner */
    .welcome-banner {
        background: linear-gradient(135deg, var(--dashboard-primary) 0%, var(--dashboard-secondary) 100%);
        color: white;
        border-radius: var(--border-radius);
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }

    .welcome-banner::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: rotate 30s linear infinite;
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .welcome-content {
        position: relative;
        z-index: 2;
    }

    .welcome-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .welcome-subtitle {
        opacity: 0.9;
        margin-bottom: 1rem;
    }

    .welcome-time {
        font-size: 0.875rem;
        opacity: 0.8;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .dashboard-container {
            padding: 1rem 0;
        }

        .stats-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .stat-card {
            padding: 1.5rem;
        }

        .actions-grid {
            grid-template-columns: 1fr;
        }

        .welcome-banner {
            padding: 1.5rem;
        }

        .welcome-title {
            font-size: 1.25rem;
        }
    }

    /* Loading States */
    .loading-skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    /* Custom Scrollbar */
    .notifications-panel::-webkit-scrollbar {
        width: 6px;
    }

    .notifications-panel::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }

    .notifications-panel::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
    }

    .notifications-panel::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="container-fluid">
        <!-- Welcome Banner -->
        <div class="welcome-banner animate__animated animate__fadeInDown">
            <div class="welcome-content">
                <h2 class="welcome-title">
                    مرحباً بك، {{ user.get_full_name|default:user.username }}
                </h2>
                <p class="welcome-subtitle">
                    {% if user.role == 'STUDENT' %}
                        نتمنى لك يوماً دراسياً مثمراً ومفيداً
                    {% elif user.role in 'TEACHER,ASSISTANT_TEACHER' %}
                        نتمنى لك يوماً تدريسياً موفقاً ومثمراً
                    {% else %}
                        نتمنى لك يوماً إدارياً ناجحاً ومنتجاً
                    {% endif %}
                </p>
                <div class="welcome-time">
                    <i class="fas fa-clock me-2"></i>
                    <span id="currentTime"></span>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            {% if user.role == 'STUDENT' %}
                <div class="stat-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
                    <div class="stat-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="stat-value">{{ stats.enrolled_courses|default:0 }}</div>
                    <div class="stat-label">المقررات المسجلة</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>نشط</span>
                    </div>
                </div>

                <div class="stat-card success animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-value">{{ stats.current_gpa|default:"0.0" }}</div>
                    <div class="stat-label">المعدل التراكمي</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>ممتاز</span>
                    </div>
                </div>

                <div class="stat-card warning animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
                    <div class="stat-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-value">{{ stats.completed_courses|default:0 }}</div>
                    <div class="stat-label">المقررات المكتملة</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-check"></i>
                        <span>مكتمل</span>
                    </div>
                </div>

                <div class="stat-card info animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
                    <div class="stat-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="stat-value">{{ stats.total_credits|default:0 }}</div>
                    <div class="stat-label">إجمالي الساعات</div>
                    <div class="stat-trend neutral">
                        <i class="fas fa-minus"></i>
                        <span>تراكمي</span>
                    </div>
                </div>

            {% elif user.role in 'TEACHER,ASSISTANT_TEACHER' %}
                <div class="stat-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
                    <div class="stat-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="stat-value">{{ stats.teaching_courses|default:5 }}</div>
                    <div class="stat-label">المقررات التي أدرسها</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>نشط</span>
                    </div>
                </div>

                <div class="stat-card success animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value">{{ stats.total_students|default:150 }}</div>
                    <div class="stat-label">إجمالي الطلاب</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>متزايد</span>
                    </div>
                </div>

                <div class="stat-card warning animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
                    <div class="stat-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="stat-value">{{ stats.pending_grades|default:25 }}</div>
                    <div class="stat-label">درجات في الانتظار</div>
                    <div class="stat-trend warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>يتطلب إجراء</span>
                    </div>
                </div>

                <div class="stat-card info animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value">85%</div>
                    <div class="stat-label">معدل الحضور</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>ممتاز</span>
                    </div>
                </div>

            {% else %}
                <!-- Admin Stats -->
                <div class="stat-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value">{{ stats.total_users|default:1000|floatformat:0 }}</div>
                    <div class="stat-label">إجمالي المستخدمين</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+5% هذا الأسبوع</span>
                    </div>
                </div>

                <div class="stat-card success animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
                    <div class="stat-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-value">{{ stats.total_students|default:850|floatformat:0 }}</div>
                    <div class="stat-label">الطلاب النشطون</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>نشط</span>
                    </div>
                </div>

                <div class="stat-card warning animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
                    <div class="stat-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="stat-value">{{ stats.total_teachers|default:75|floatformat:0 }}</div>
                    <div class="stat-label">أعضاء هيئة التدريس</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-check"></i>
                        <span>مستقر</span>
                    </div>
                </div>

                <div class="stat-card info animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
                    <div class="stat-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="stat-value">98%</div>
                    <div class="stat-label">صحة النظام</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-check-circle"></i>
                        <span>ممتاز</span>
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions animate__animated animate__fadeInUp" style="animation-delay: 0.5s;">
            <h3>
                <i class="fas fa-bolt"></i>
                الإجراءات السريعة
            </h3>
            <div class="actions-grid">
                {% for action in quick_actions %}
                <a href="{{ action.url }}" class="action-btn">
                    <div>
                        <div style="font-weight: 600;">{{ action.title }}</div>
                        <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">
                            وصول سريع
                        </div>
                    </div>
                    <i class="{{ action.icon }}"></i>
                </a>
                {% empty %}
                <!-- Default actions -->
                <a href="/admin/" class="action-btn">
                    <div>
                        <div style="font-weight: 600;">لوحة الإدارة</div>
                        <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">
                            إدارة شاملة
                        </div>
                    </div>
                    <i class="fas fa-cog"></i>
                </a>
                <a href="/api/docs/" class="action-btn">
                    <div>
                        <div style="font-weight: 600;">توثيق API</div>
                        <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">
                            مرجع المطورين
                        </div>
                    </div>
                    <i class="fas fa-book"></i>
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Main Content Area -->
            <div class="dashboard-card animate__animated animate__fadeInUp" style="animation-delay: 0.6s;">
                <h4>
                    <i class="fas fa-chart-area"></i>
                    نظرة عامة على الأنشطة
                </h4>
                
                <!-- Chart Container -->
                <div class="chart-container">
                    <canvas id="activityChart"></canvas>
                </div>

                <!-- Progress Indicators -->
                <div style="margin-top: 2rem;">
                    <div class="progress-item">
                        <div class="progress-header">
                            <span class="progress-label">إكمال المهام</span>
                            <span class="progress-value">75%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: 75%;"></div>
                        </div>
                    </div>

                    <div class="progress-item">
                        <div class="progress-header">
                            <span class="progress-label">مستوى التفاعل</span>
                            <span class="progress-value">90%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: 90%; background: linear-gradient(90deg, var(--dashboard-success), #34d399);"></div>
                        </div>
                    </div>

                    <div class="progress-item">
                        <div class="progress-header">
                            <span class="progress-label">الأداء العام</span>
                            <span class="progress-value">85%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: 85%; background: linear-gradient(90deg, var(--dashboard-info), #38bdf8);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div>
                <!-- Notifications -->
                <div class="dashboard-card animate__animated animate__fadeInUp" style="animation-delay: 0.7s;">
                    <h4>
                        <i class="fas fa-bell"></i>
                        الإشعارات الحديثة
                        {% if notifications %}
                        <span class="badge bg-primary rounded-pill">{{ notifications|length }}</span>
                        {% endif %}
                    </h4>
                    
                    <div class="notifications-panel">
                        {% for notification in notifications %}
                        <div class="notification-item {% if not notification.is_read %}unread{% endif %}">
                            {% if not notification.is_read %}
                            <div class="notification-dot"></div>
                            {% endif %}
                            <div class="notification-content">
                                <div class="notification-title">{{ notification.title }}</div>
                                <div class="notification-desc">{{ notification.message|truncatechars:100 }}</div>
                                <div class="notification-time">{{ notification.created_at|timesince }} مضت</div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-bell-slash fa-2x mb-2"></i>
                            <p>لا توجد إشعارات جديدة</p>
                        </div>
                        {% endfor %}
                    </div>

                    {% if notifications %}
                    <div class="text-center mt-3">
                        <a href="{% url 'web:notifications' %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-eye"></i>
                            عرض جميع الإشعارات
                        </a>
                    </div>
                    {% endif %}
                </div>

                <!-- Recent Activities -->
                <div class="dashboard-card animate__animated animate__fadeInUp" style="animation-delay: 0.8s;">
                    <h4>
                        <i class="fas fa-history"></i>
                        الأنشطة الأخيرة
                    </h4>
                    
                    <div>
                        {% for activity in recent_activities %}
                        <div class="activity-item">
                            <div class="activity-icon {{ activity.type|default:'info' }}">
                                <i class="{{ activity.icon|default:'fas fa-info-circle' }}"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">{{ activity.title }}</div>
                                <div class="activity-desc">{{ activity.description }}</div>
                                <div class="activity-time">{{ activity.timestamp|timesince }} مضت</div>
                            </div>
                        </div>
                        {% empty %}
                        <!-- Default activities -->
                        <div class="activity-item">
                            <div class="activity-icon success">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">تسجيل دخول ناجح</div>
                                <div class="activity-desc">تم تسجيل الدخول بنجاح إلى النظام</div>
                                <div class="activity-time">منذ قليل</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon info">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">زيارة لوحة التحكم</div>
                                <div class="activity-desc">تم الوصول إلى لوحة التحكم الرئيسية</div>
                                <div class="activity-time">منذ دقيقة</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon warning">
                                <i class="fas fa-sync"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">تحديث البيانات</div>
                                <div class="activity-desc">تم تحديث إعدادات الحساب</div>
                                <div class="activity-time">منذ 5 دقائق</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Update current time
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleString('ar-SA', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        document.getElementById('currentTime').textContent = timeString;
    }
    
    updateTime();
    setInterval(updateTime, 60000); // Update every minute

    // Initialize Activity Chart
    const ctx = document.getElementById('activityChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],
                datasets: [{
                    label: 'النشاط اليومي',
                    data: [65, 78, 90, 81, 95, 70, 85],
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'المهام المكتملة',
                    data: [45, 52, 70, 65, 75, 60, 68],
                    borderColor: 'rgb(16, 185, 129)',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        }
                    }
                }
            }
        });
    }

    // Stat card click effects
    document.querySelectorAll('.stat-card').forEach(card => {
        card.addEventListener('click', function() {
            this.style.transform = 'scale(0.98)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
        });
    });

    // Notification click handler
    document.querySelectorAll('.notification-item').forEach(item => {
        item.addEventListener('click', function() {
            if (this.classList.contains('unread')) {
                this.classList.remove('unread');
                // Here you would make an AJAX call to mark as read
                // fetch('/web/notifications/' + notificationId + '/read/', {method: 'POST'})
            }
        });
    });

    // Auto-refresh notifications every 30 seconds
    setInterval(function() {
        fetch('/web/api/dashboard-stats/')
            .then(response => response.json())
            .then(data => {
                // Update notifications count if changed
                if (data.notifications_count !== undefined) {
                    const badge = document.querySelector('.notifications-panel .badge');
                    if (badge && data.notifications_count > 0) {
                        badge.textContent = data.notifications_count;
                    }
                }
            })
            .catch(error => console.log('Error refreshing data:', error));
    }, 30000);

    // Add loading states for async operations
    function showLoading(element) {
        element.classList.add('loading-skeleton');
    }

    function hideLoading(element) {
        element.classList.remove('loading-skeleton');
    }

    // Progressive enhancement for better UX
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/static/sw.js').catch(console.error);
    }

    console.log('Dashboard initialized successfully! 🎓');
});
</script>
{% endblock %}